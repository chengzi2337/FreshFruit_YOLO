device_target: "CPU"
mode_name: "GRAPH"
is_distributed: False
clip_grad: True
clip_grad_value: 10.0

# Prevent overflow - critical for stable training
ms_loss_scaler: "static"
ms_loss_scaler_value: 1.0
overflow_still_update: False
keep_loss_fp32: True

# --- DATA ---
data:
  dataset_name: "coco"
  data_dir: "D:/code/FreshFruit_YOLO/dataset"
  nc: 17
  train_set: "D:/code/FreshFruit_YOLO/dataset/train.txt"
  val_set: "D:/code/FreshFruit_YOLO/dataset/val.txt"
  test_set: "D:/code/FreshFruit_YOLO/dataset/val.txt"
  names: [
    'Apple_healthy', 'Apple_rotten', 'Banana_healthy', 'Banana_rotten', 
    'Beans_healthy', 'Beans_rotten', 'Grape_healthy', 'Grape_rotten', 
    'Mango_healthy', 'Mango_rotten', 'Orange_healthy', 'Orange_rotten', 
    'Potato_healthy', 'Potato_rotten', 'Tomato_healthy', 'Tomato_rotten', 
    'non_produce'
  ]
  num_parallel_workers: 1
  
  # Standard transforms - letterbox converts xywhn->ltrb, label_norm converts ltrb->xywhn
  train_transforms:
    - { func_name: letterbox }
    - { func_name: label_norm, xyxy2xywh_: True }
    - { func_name: label_pad }
    - { func_name: fliplr, prob: 0.5 }
    - { func_name: image_norm, scale: 255.0 }
    - { func_name: image_transpose, bgr2rgb: True, hwc2chw: True }
  test_transforms:
    - { func_name: letterbox }
    - { func_name: label_norm, xyxy2xywh_: True }
    - { func_name: label_pad }
    - { func_name: image_norm, scale: 255.0 }
    - { func_name: image_transpose, bgr2rgb: True, hwc2chw: True }

# --- OPTIMIZER ---
optimizer:
  optimizer: "momentum"
  lr_init: 0.0001
  warmup_epochs: 3
  min_warmup_step: 100
  epochs: 5
  batch_size: 4
  num_parallel_workers: 1

# --- LOSS ---
loss:
  name: YOLOv5Loss
  box: 0.05
  cls: 0.5
  obj: 1.0
  anchor_t: 4.0
  label_smoothing: 0.0
  fl_gamma: 0.0
  cls_pw: 1.0
  obj_pw: 1.0

# --- NETWORK ---
network:
  model_name: yolov5  
  nc: 17
  depth_multiple: 0.33
  width_multiple: 0.25
  stride: [8, 16, 32]
  anchors:
    - [10,13, 16,30, 33,23]
    - [30,61, 62,45, 59,119]
    - [116,90, 156,198, 373,326]
  backbone:
    [[-1, 1, ConvNormAct, [64, 6, 2, 2]],
     [-1, 1, ConvNormAct, [128, 3, 2]],
     [-1, 3, C3, [128]],
     [-1, 1, ConvNormAct, [256, 3, 2]],
     [-1, 6, C3, [256]],
     [-1, 1, ConvNormAct, [512, 3, 2]],
     [-1, 9, C3, [512]],
     [-1, 1, ConvNormAct, [1024, 3, 2]],
     [-1, 3, C3, [1024]],
     [-1, 1, SPPF, [1024, 5]],
    ]
  head:
    [[-1, 1, ConvNormAct, [512, 1, 1]],
     [-1, 1, Upsample, [None, 2, 'nearest']],
     [[-1, 6], 1, Concat, [1]],
     [-1, 3, C3, [512, False]],
     [-1, 1, ConvNormAct, [256, 1, 1]],
     [-1, 1, Upsample, [None, 2, 'nearest']],
     [[-1, 4], 1, Concat, [1]],
     [-1, 3, C3, [256, False]],
     [-1, 1, ConvNormAct, [256, 3, 2]],
     [[-1, 14], 1, Concat, [1]],
     [-1, 3, C3, [512, False]],
     [-1, 1, ConvNormAct, [512, 3, 2]],
     [[-1, 10], 1, Concat, [1]],
     [-1, 3, C3, [1024, False]],
     [[17, 20, 23], 1, YOLOv5Head, [nc, anchors, stride]],
    ]